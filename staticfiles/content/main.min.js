main_url =''
// url: 'http://127.0.0.1:8000' вроде такой локальный,

/////Обновления корзины в шапке сайта/////
function readyFn( jQuery ) {
  let form = $('.basket_item')
  let data = {}
  let csrf_token = $('.basket [name="csrfmiddlewaretoken"]').val()
  data["csrfmiddlewaretoken"] = csrf_token

  $.ajax({
    url: `${main_url}/shop/basket`,
    type: 'POST',
    data: data,
    cache: true,
    success: function (data) {
        console.log("OK1");
        form.html('<p>' + data.sum + '</p>')
        form.height(30)
        form.width(30)
    },
    error: function(){

        console.log("error")
    }
})
}


//////Количество товара + их цена(вывод в html корзины)///////////////

function basketFn1(slug, data, price) {
  $(`.${slug}_${price} .money`).html(`${data*price} ₴`)
  $(`.${slug}_${price} .quantity`).html(`${data}`)
  
  }

//////Общая цена товара пользователя(вывод в html корзины)///////////////

function sumBasketFn2() {

let eachProduct = $(".you_basket");
  let sum = 0
  eachProduct.each(function(index, element){
    //let slug = $(this).find('.same-info').val()
    let price = $(this).find('.main_price').val()
    let nmb = $(this).find('.quantity').text().split(/\s+/g)
    for (i in  nmb){
      if (nmb[i] != ''){
        nmbN = nmb[i]
      }
    }
    sum +=  Number(price)*Number(nmbN)
  })

  $(`.checkout`).find('.sum').html(sum + '₴')

}




/////добавления товара + вызов Доп ф-й/////
$(function(){
  let form = $('.form-prod')
  //console.log(form)
  readyFn()
  sumBasketFn2()
  form.on('submit', function(e){
    e.preventDefault()
    if ($(this).click()){
      let slug = $(this).find('.same-info').val()
      let price = $(this).find('.main_price').val()
      let volume = $(this).find('.main_volume').val()
      let data = {}
      data.slug = slug
      data.price = price
      data.volume = volume
      let csrf_token = $('.form-prod [name="csrfmiddlewaretoken"]').val()
      
      data["csrfmiddlewaretoken"] = csrf_token

      $.ajax({
        url: `${main_url}/shop/basket_adding`,
        type: 'POST',
        data: data,
        cache: true,
        success: function (data) {
          console.log("OK")
          readyFn()
          basketFn1(slug, data.quantity_new, data.price)
          sumBasketFn2()
        },
        error: function(){
            console.log("error")
        }
    })
    }
  })
})



/////Обработка отнимания товара + вызов доп ф-й/////
$(function(){
  let form = $('.form-prod-minus')
  //console.log(form)
  form.on('submit', function(e){
    e.preventDefault()
    if ($(this).click()){
      let slug = $(this).find('.same-info').val()
      let price = $(this).find('.main_price').val()
      let volume = $(this).find('.main_volume').val()
      let data = {}
      data.slug = slug
      data.price = price
      data.volume = volume
      let csrf_token = $('.form-prod [name="csrfmiddlewaretoken"]').val()
      data["csrfmiddlewaretoken"] = csrf_token
     // console.log(data)

      $.ajax({
        url: `${main_url}/shop/basket_minus`,
        type: 'POST',
        data: data,
        cache: true,
        success: function (data) {
            if (data.key == 1){
              console.log("OK");
              basketFn1(slug, data.quantity_new, data.price)
              readyFn() 
              sumBasketFn2()
            }else{
              console.log("OK");
              location.reload();  
              readyFn()
              sumBasketFn2()
              
            }


        },
        error: function(){
            //console.log(url)
            console.log("error")
        }
    })
    }
  })
})



//Живой поиск по БД через вьюшку + вывод полей ///
$(function(){
  let form = $('.search_form input')
  //console.log(form)
  form.keyup(function(e){
    let data = {}
    data.val = form.attr('value')
    let csrf_token = $('.basket [name="csrfmiddlewaretoken"]').val()
    data["csrfmiddlewaretoken"] = csrf_token
    $.ajax({
      url: `${main_url}/shop/search`,
      type: 'POST',
      data: data,
      cache: true,
      success: function (data) {
        let possibly = ''
        for (i in data){
          possibly += `<div class="list-group-item"><a href="/shop/${data[i]}">${i}</a></div>`  
        }
        $('.list-group-search').html(possibly)
      },
      error: function(){
          //console.log(url)
          console.log("error")
      }
  })

  })
})



////Подключка АПИ новой почты/////
$(function(){
  let form = $('.npc .input')
  form.keyup(function(e){
    let some = form.attr('value')

    data = `<?xml version="1.0" encoding="UTF-8"?>
    <file>
    <apiKey>978da96a7ed06df0dc3ddfec6ce50695</apiKey>
    <modelName>Address</modelName>
    <calledMethod>searchSettlements</calledMethod>
    <methodProperties>
    <CityName>${some}</CityName>
    <Limit>15</Limit>
    </methodProperties>
    </file>`
    $.ajax({
      url: `https://api.novaposhta.ua/v2.0/xml/`,
      type: 'POST',
      data: data,
      cache: true,
      success: function (data) {
            console.log("OK")
            let possibly = ''
            $.each($(data).find('Addresses item'),function(){
              let city = $(this).find('Present').html()
              let ref = $(this).find('MainDescription').html()
              possibly += ` <div class="list-group-item list-group-item-town">
              <input type="hidden" value="${ref}">
              <p>${city}</p>
              </div> `
            })
            $('.list-group-search-town').html(possibly)
      },
      error: function(){
          console.log("error")
      }


    })
    
  })
})



//Появления/убирание поиска города в форме новой почты ///
$(document).ready(function() {
  $( ".npc" ).hover(
    function() {
      $('.list-group-search-town').css({'display' : 'block'})
    }, function() {
      $('.list-group-search-town').css({'display' : 'none'})
    }
  )
})


//Обработка клика в поиске города)
$(document).ready(function() {

  $(".list-group-item-town").live('click',function() {
    $('.npc .inputH').val($(this).find('input').val())
    $('.npc .input').val($(this).find('p').html())
    $('.list-group-search-town').html('')

  })
})



////Подключка АПИ новой почты + поиск отделения /////
$(function(){
  let form = $('.branches input')
  form.keyup(function(e){
    let some = form.attr('value')
    let cityRef = $('.npc .inputH').val()
    let cityName = $('.npc .input').val()
    data = `<?xml version="1.0" encoding="UTF-8" ?>
    <root>
      <modelName>AddressGeneral</modelName>
      <calledMethod>getWarehouses</calledMethod>
      <methodProperties>
        <Limit>15</Limit>
        <CityName>${cityRef}</CityName>
        <Language>ru</Language>
      </methodProperties>
      <apiKey>978da96a7ed06df0dc3ddfec6ce50695</apiKey>
    </root>`

    $.ajax({
      url: `https://api.novaposhta.ua/v2.0/xml/`,
      type: 'POST',
      data: data,
      cache: true,
      success: function (data) {
            console.log("OK")
            let possibly = ''
            $.each($(data).find('Description'),function(){
              let str = $(this).html()
              if (str.indexOf(some) != -1){
                possibly += ` <div class="list-group-item list-group-item-description">
                <p>${str}</p>
                </div> `
              }
            $('.list-group-search-description').html(possibly)
            })
            
      },
      error: function(){
          console.log("error")
      }


    })
    
  })
})


//Появления/убирание поиска отделения в форме новой почты ///
$(document).ready(function() {
  $( ".branches" ).hover(
    function() {
      $('.list-group-search-description').css({'display' : 'block'})
    }, function() {
      $('.list-group-search-description').css({'display' : 'none'})
    }
  )
})


//Обработка клика в поиске отделения)
$(document).ready(function() {

  $(".list-group-item-description").live('click',function() {
    //$('.npc .inputH').val($(this).find('input').val())
    $('.branches input').val($(this).find('p').html())
    $('.list-group-search-description').html('')

  })
})





//Переключатель Обьема + цены в магазине(гланая, категории)///

$(document).ready(function() {

  $(".btn_volume_1").click(function() {
    slug ='.' +  $(this).find('.slug').val()
    volume = $(this).find('.btn_volume1').val()
    price1 = $(this).find('.btn_prise1').val()
    $(this).attr('disabled', true);
    $(`${slug} .btn_volume_2`).attr('disabled', false)
    $(`${slug} .btn_prise .price`).html(`${price1} грн.`)
    $(`${slug} .form-prod .main_price`).val(price1)
    $(`${slug} .form-prod .main_volume`).val(volume)
    

  })
  $(".btn_volume_2").click(function() {
    slug ='.' + $(this).find('.slug').val()
    volume = $(this).find('.btn_volume2').val()
    price2 = $(this).find('.btn_prise2').val()

    $(this).attr('disabled', true)
    $(`${slug} .btn_volume_1`).attr('disabled', false)
    $(`${slug} .btn_prise .price`).html(`${price2} грн.`)
    $(`${slug} .form-prod .main_price`).val(price2)
    $(`${slug} .form-prod .main_volume`).val(volume)
    
  })

})


$(document).ready(function() {
  $("#menuCheck").click(function() {

    $(".newLayer").addClass('show')
  })
})

$(document).ready(function() {
  $(".close").click(function() {

    $(".newLayer").removeClass('show')
  })
})

$(document).ready(function() {
  $(".black").click(function() {

    $(".newLayer").removeClass('show')
  })
})


$(document).ready(function() {
  $(".block0").hover(function() {
    $(this).addClass('style')
    $("button", this).css({'opacity': '1'})
    
  },function(){
    $(this).removeClass('style')
    $("button", this).css({'opacity': '0'})
  })
})



///Выпадающее меню категории///
$(document).ready(function() {
  $(".list-group").hover(function() {
      $('.list-group-sub').css({'display': 'block'})
  },function(){
    if ($(window).width() <= '975'){
    $('.list-group-sub').css({'display': 'none'})
    }
    
  })
})
///ТУпая ф-я возрата категорий
function stupidFn( jQuery ){
  if ($(window).width() >= '975'){
    $('.list-group-sub').css({'display': 'block'})
    $('.list-group img').attr('src', ' ')
}else{
  $('.list-group img').attr('src', '/static/shop/img/ar_bottom.png')
  $('.list-group-sub').css({'display': 'none'})
}
}

///Смена логотипа в шапке////

function logoFn( jQuery ){
  if ($(window).width() <= '576'){
    $('.logo img').attr('src', '/static/content/img/logo.svg')
} else {
    $('.logo img').attr('src', '/static/content/img/logo_big.svg')
}
}

///Запуск ф-й при смене размере окна ///
$(document).ready(function() {
  logoFn()
  stupidFn()
  $(window).resize(function() {
    logoFn()
    stupidFn()

 });
})


//Замена урла главной картинки на shop_detail ///
$(document).ready(function() {
  $(".gal_img").click(function() {
  src = $(this).find('img').attr('src')  

    $(".main_img img").attr('src', src)
  })
})

//Появления/убирание поиска + смена фона картинки поиска ///
$(document).ready(function() {
  $(".search").click(function() {
    if ($('.search_form').css('display') == 'none'){
      $('.search_form').css({'display': 'block'})
      $(this).css({'background-color': 'white'})
    }else{
      $('.search_form').css({'display': 'none'})
      $(this).css({'background-color': 'none'})
    }
  })
})

// Появления/убирание пунктов менюшки поиска ///
$(document).ready(function() {
  $(".search_form").hover(function() {
    $(".list-group-search").css({'opacity': '1'})
    
  },function(){
    $(".list-group-search").css({'opacity': '0'})
  })
})



///Появления формы заказа ///
$(document).ready(function() {
  $(".checkout button").click(function(e) {
    e.preventDefault()
    $('.body_form_basket').css({'left' : '0px'})
    $('.checkout').css({'left' : '-100%'})
  })
})

///Скрытие формы заказа ///
$(document).ready(function() {
  $(".closer").click(function(e) {
    e.preventDefault()
    $('.body_form_basket').css({'left' : '-100%;'})
    $('.checkout').css({'left' : '0px;'})
  })
})

///Скрытие формы заказа ///
$(document).ready(function() {
  $(".form_basket .btt ").click(function(e){
    e.preventDefault()
    let info = $('.form_basket #form_name').val()
    let phone = $('.form_basket #form_phone').val()
    let description = $('.form_basket #form_description').val()
    let town = $('.form_basket #form_town').val()
    let branches = $('.form_basket #form_branches').val()

    let data = {}
    let csrf_token = $('.basket [name="csrfmiddlewaretoken"]').val()
    data["csrfmiddlewaretoken"] = csrf_token
    data["info"] = info
    data["phone"] = phone
    data["description"] = description
    data["town"] = town
    data["branches"] = branches
    if (info && phone && town && branches){
      $.ajax({
        url: `${main_url}/shop/order`,
        type: 'POST',
        data: data,
        cache: true,
        success: function (data) {
          console.log('OKs')
          var url = "/";
          $(location).attr('href',url);
        },
        error: function(){
            console.log("error")
        }
      })
    }else{
     alert('Пожалуйста заполните основные поля')
    }



   


  })
})




AOS.init();
// You can also pass an optional settings object
// below listed default settings
AOS.init({
  // Global settings:
  disable: false, // accepts following values: 'phone', 'tablet', 'mobile', boolean, expression or function
  startEvent: 'DOMContentLoaded', // name of the event dispatched on the document, that AOS should initialize on
  initClassName: 'aos-init', // class applied after initialization
  animatedClassName: 'aos-animate', // class applied on animation
  useClassNames: false, // if true, will add content of `data-aos` as classes on scroll
  disableMutationObserver: false, // disables automatic mutations' detections (advanced)
  debounceDelay: 50, // the delay on debounce used while resizing window (advanced)
  throttleDelay: 99, // the delay on throttle used while scrolling the page (advanced)


  // Settings that can be overridden on per-element basis, by `data-aos-*` attributes:
  offset: 220, // offset (in px) from the original trigger point
  delay: 0, // values from 0 to 3000, with step 50ms
  duration: 1200, // values from 0 to 3000, with step 50ms
  easing: 'ease', // default easing for AOS animations
  once: true, // whether animation should happen only once - while scrolling down
  mirror: false, // whether elements should animate out while scrolling past them
  anchorPlacement: 'top-bottom', // defines which position of the element regarding to window should trigger the animation

});



$('.responsive').slick({
  dots: true,
  infinite: true,
  speed: 300,
  slidesToShow: 1,
  centerMode: true,
  variableWidth: true,
  autoplay: true,
  autoplaySpeed: 2000,
});


